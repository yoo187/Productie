<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Productie Registratie</title>

<style>
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:Arial,sans-serif;background:#f2f4f7}
.app{padding:12px}
h1{text-align:center;font-size:1.6rem;margin:12px 0 20px}
h2{font-size:1.3rem;margin-bottom:12px}
h3{font-size:1.15rem;margin:16px 0 8px}

.day-container{margin-bottom:24px}
.day-title{font-size:1.2rem;margin-bottom:12px;font-weight:bold}

.card{
  background:#fff;
  border-radius:16px;
  padding:16px;
  margin-bottom:16px;
  box-shadow:0 4px 10px rgba(0,0,0,.08);
}

.card.readonly{opacity:.95}

.grid{display:flex;flex-direction:column;gap:12px;margin-bottom:12px}
label{font-weight:bold;font-size:.95rem}
input,select,textarea{
  width:100%;
  padding:14px;
  font-size:1.05rem;
  border-radius:12px;
  border:1px solid #ccc;
}
textarea{resize:vertical}

button{padding:12px;font-size:1rem;border-radius:10px;border:none;cursor:pointer}
.add{background:#2ecc71;color:#fff}
.remove{background:#e74c3c;color:#fff}
.done{background:#27ae60;color:#fff}
.notdone{background:#c0392b;color:#fff}
.delete-klant{background:#555;color:#fff;margin-top:10px}

.productie-row{
  display:flex;
  flex-direction:column;
  gap:10px;
  padding:12px;
  border-radius:12px;
  border:2px solid #ddd;
  margin-bottom:12px;
}

.productie-row.in-progress{border-color:#f39c12;background:#fff3e0;}
.productie-row.done-row{border-color:#27ae60;background:#eafaf1;}
.productie-row.notdone-row{border-color:#c0392b;background:#fde6e0;}

.actions{display:flex;gap:8px;flex-wrap:wrap}
.search-block{background:#eef1f5;border-radius:16px;padding:16px;margin-bottom:20px}

@media(min-width:768px){
  .grid{flex-direction:row}
  .productie-row{flex-direction:row;flex-wrap:wrap}
  .productie-row>div{flex:1;min-width:140px}
}
</style>
</head>

<body>
<div class="app">

<h1>Productie Registratie</h1>

<div class="card">
  <h2>Algemene gegevens</h2>
  <div class="grid">
    <div><label>Naam</label><input value="Denislav Dimitrov" readonly></div>
    <div><label>Datum</label><input type="date" id="datum"></div>
    <div>
      <label>Vervoer</label>
      <select id="vervoer">
        <option>Fiets</option>
        <option>Wagen</option>
      </select>
    </div>
  </div>
</div>

<div class="search-block">
  <label>Zoeken</label>
  <input placeholder="Dossier nummer..." oninput="zoekAlleDagen(this.value)">
  <div id="zoekResultaten"></div>
</div>

<div id="dagContainer">
  <div id="productieCards"></div>
  <button class="add" onclick="nieuweKlant()">Nieuwe klant</button>
  <h3>Dag totaal: <span id="dagTotaal">0.00</span></h3>
  <button onclick="window.print()">Afdrukken / PDF</button>
</div>

</div>

<script>
const types=[
"Raam kader","Raam vleugel","Deur kader","Deur vleugel",
"Schuifraam kader","Schuifraam vleugel","T-profiel",
"Glaslatten","Beslag","Opkuisen","Montage","Andere"
];

const datum=document.getElementById("datum");
datum.valueAsDate=new Date();

function key(d=datum.value){return "productie-"+d}

function editRijHTML(r={}){
  const status=r.status||"in-progress";
  return `
  <div class="productie-row ${status}" data-status="${status}">
    <div><label>Type</label>
      <select>${types.map(t=>`<option ${r.type===t?"selected":""}>${t}</option>`).join("")}</select>
    </div>
    <div><label>Aantal</label><input type="number" value="${r.aantal||0}"></div>
    <div><label>Uren</label><input type="number" step="0.01" class="uren-input" value="${r.uren||0}"></div>
    <div><label>Opmerking</label><textarea class="opmerking">${r.opmerking||""}</textarea></div>
    <div class="actions">
      <button class="done" onclick="markDone(this)">Voltooid</button>
      <button class="notdone" onclick="markNotDone(this)">Niet voltooid</button>
      <button class="remove" onclick="verwijderRij(this)">X</button>
    </div>
  </div>`;
}

function nieuweKlant(data=null){
  const c=document.getElementById("productieCards");
  const card=document.createElement("div");
  card.className="card";
  card.innerHTML=`
    <div class="grid">
      <div><label>Klant</label><input value="${data?.klant||""}"></div>
      <div><label>Dossier</label><input value="${data?.dossier||""}"></div>
    </div>
    ${(data?.rijen||[{}]).map(r=>editRijHTML(r)).join("")}
    <button class="add" onclick="addRij(this)">Rij toevoegen</button>
    <strong>Totaal klant: <span class="klantTotaal">0.00</span></strong>
    <button class="delete-klant" onclick="verwijderKlant(this)">Klant verwijderen</button>
  `;
  c.appendChild(card);
  bind(card);
  bereken();
}

function addRij(btn){btn.insertAdjacentHTML("beforebegin",editRijHTML());bind(btn.closest(".card"))}
function bind(card){
  card.querySelectorAll("input,select,textarea").forEach(i=>i.addEventListener("input",opslaan));
}

function verwijderKlant(btn){if(confirm("Klant verwijderen?")){btn.closest(".card").remove();opslaan()}}
function verwijderRij(btn){btn.closest(".productie-row").remove();opslaan()}

function markDone(btn){
  const r=btn.closest(".productie-row");
  r.className="productie-row done-row";
  r.dataset.status="done-row";
  opslaan();
}
function markNotDone(btn){
  const r=btn.closest(".productie-row");
  r.className="productie-row notdone-row";
  r.dataset.status="notdone-row";
  opslaan();
}

function bereken(){
  let dag=0;
  document.querySelectorAll(".card").forEach(c=>{
    let klant=0;
    c.querySelectorAll(".uren-input").forEach(i=>klant+=+i.value||0);
    const el=c.querySelector(".klantTotaal");
    if(el) el.textContent=klant.toFixed(2);
    dag+=klant;
  });
  document.getElementById("dagTotaal").textContent=dag.toFixed(2);
}

function opslaan(){
  bereken();
  const data={
    vervoer:vervoer.value,
    klanten:[...document.querySelectorAll("#productieCards .card")].map(c=>({
      klant:c.querySelectorAll("input")[0].value,
      dossier:c.querySelectorAll("input")[1].value,
      rijen:[...c.querySelectorAll(".productie-row")].map(r=>({
        type:r.querySelector("select").value,
        aantal:r.querySelector("input[type=number]").value,
        uren:r.querySelector(".uren-input").value,
        opmerking:r.querySelector(".opmerking").value,
        status:r.dataset.status||"in-progress"
      }))
    }))
  };
  localStorage.setItem(key(),JSON.stringify(data));
}

function laadDag(){
  productieCards.innerHTML="";
  const d=JSON.parse(localStorage.getItem(key())||"null");
  if(!d){nieuweKlant();return}
  vervoer.value=d.vervoer;
  d.klanten.forEach(k=>nieuweKlant(k));
}

function formatDDMMYYYY(d){
  const dt=new Date(d);
  return `${dt.getDate().toString().padStart(2,"0")}-${(dt.getMonth()+1).toString().padStart(2,"0")}-${dt.getFullYear()}`;
}

function zoekAlleDagen(val){
  const res=document.getElementById("zoekResultaten");
  const dagContainer=document.getElementById("dagContainer");
  res.innerHTML="";
  if(!val){dagContainer.style.display="block";return}
  dagContainer.style.display="none";

  Object.keys(localStorage).forEach(k=>{
    if(!k.startsWith("productie-"))return;
    const d=JSON.parse(localStorage[k]);
    const matches=d.klanten.filter(c=>c.dossier.toLowerCase().includes(val.toLowerCase()));
    if(matches.length){
      res.innerHTML+=`<h3>ðŸ“… ${formatDDMMYYYY(k.replace("productie-",""))}</h3>`;
      matches.forEach(m=>{
        res.innerHTML+=`
        <div class="card readonly">
          <div class="grid">
            <div><label>Klant</label><input value="${m.klant}" readonly></div>
            <div><label>Dossier</label><input value="${m.dossier}" readonly></div>
          </div>
          ${m.rijen.map(r=>`
            <div class="productie-row ${r.status}">
              <div>${r.type}</div>
              <div>${r.aantal}</div>
              <div>${r.uren}</div>
              <div>${r.opmerking}</div>
            </div>`).join("")}
        </div>`;
      });
    }
  });
}

datum.addEventListener("change",laadDag);
laadDag();
</script>
</body>
</html>
