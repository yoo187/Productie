<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Urenregistratie V35 - Status Glow</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Plus+Jakarta+Sans:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --cyber-blauw: #00f0ff;
            --cyber-paars: #6e00ff;
            --cyber-rood: #ff003c;
            --cyber-groen: #00ff66;
            --bg: #050608;
            --paneel-bg: rgba(20, 25, 35, 0.7);
            --transition-smooth: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body { 
            background: var(--bg); color: #fff; 
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-image: 
                radial-gradient(circle at 50% 10%, rgba(110, 0, 255, 0.15) 0%, transparent 50%),
                linear-gradient(rgba(255, 255, 255, 0.02) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 255, 255, 0.02) 1px, transparent 1px);
            background-size: 100% 100%, 30px 30px, 30px 30px;
            min-height: 100vh; padding-bottom: 120px;
        }

        h1, h2, .timer-display, .btn-cyber { font-family: 'Orbitron', sans-serif; }

        header {
            background: rgba(10, 12, 18, 0.98); backdrop-filter: blur(15px);
            border-bottom: 1px solid var(--cyber-blauw);
            padding: 15px; position: sticky; top: 0; z-index: 2000;
        }
        .header-grid { max-width: 900px; margin: 0 auto; display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }

        input, select, textarea {
            background: rgba(0, 0, 0, 0.5); border: 1px solid rgba(0, 240, 255, 0.3);
            color: #fff; padding: 12px; border-radius: 6px; width: 100%; transition: 0.3s;
        }

        /* --- SEARCH HOLOGRAAM EFFECT --- */
        .search-wrap { grid-column: 1 / -1; position: relative; margin-top: 10px; }
        #archiefLijst {
            position: absolute; top: calc(100% + 5px); left: 0; right: 0; 
            background: rgba(10, 25, 40, 0.9); border: 1px solid var(--cyber-blauw);
            max-height: 0; overflow: hidden; z-index: 3000; border-radius: 8px;
            transition: var(--transition-smooth); opacity: 0; 
            box-shadow: 0 0 25px rgba(0, 240, 255, 0.3), inset 0 0 20px rgba(0, 240, 255, 0.1);
            backdrop-filter: blur(15px);
        }
        #archiefLijst.open { max-height: 400px; opacity: 1; overflow-y: auto; padding: 10px 0; border-top: 2px solid var(--cyber-blauw); }
        .zoek-optie { 
            padding: 12px 20px; border-bottom: 1px solid rgba(0, 240, 255, 0.1); 
            cursor: pointer; color: var(--cyber-blauw); font-family: 'Orbitron'; 
            font-size: 0.75rem; transition: 0.3s; line-height: 1.4;
        }
        .zoek-optie:hover { background: rgba(0, 240, 255, 0.2); color: #fff; text-shadow: 0 0 10px var(--cyber-blauw); padding-left: 25px; }
        .zoek-optie b { color: #fff; font-size: 0.8rem; }
        .zoek-optie .dos-label { color: var(--cyber-groen); text-shadow: 0 0 8px rgba(0, 255, 102, 0.5); font-size: 0.65rem; display: block; }

        /* --- KAART & STATUS --- */
        .kaart { 
            background: var(--paneel-bg); border: 1px solid rgba(255, 255, 255, 0.05); 
            border-radius: 12px; margin-bottom: 20px; overflow: hidden; 
            backdrop-filter: blur(10px); animation: holo-deploy 0.5s ease-out forwards;
            transition: var(--transition-smooth);
        }
        .kaart-h { padding: 20px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; position: relative; }

        .status-voltooid { border: 1px solid var(--cyber-groen); box-shadow: 0 0 20px rgba(0, 255, 102, 0.15); }
        .status-voltooid .kaart-h { background: linear-gradient(90deg, rgba(0, 255, 102, 0.15), transparent); border-bottom: 1px solid var(--cyber-groen); }
        
        .status-fout { border: 1px solid var(--cyber-rood); box-shadow: 0 0 20px rgba(255, 0, 60, 0.15); }
        .status-fout .kaart-h { background: linear-gradient(90deg, rgba(255, 0, 60, 0.15), transparent); border-bottom: 1px solid var(--cyber-rood); }

        .kaart-anim-wrapper { display: grid; grid-template-rows: 1fr; transition: grid-template-rows 0.5s ease; }
        .ingeklapt .kaart-anim-wrapper { grid-template-rows: 0fr; }
        .kaart-inner { overflow: hidden; }
        .kaart-b { padding: 20px; border-top: 1px solid rgba(255,255,255,0.05); }

        .r { margin-bottom: 15px; border-bottom: 1px solid rgba(255,255,255,0.05); padding-bottom: 15px; animation: holo-deploy 0.4s ease-out forwards; }
        .removing { animation: holo-remove 0.4s ease-in forwards !important; pointer-events: none; }

        /* --- TIMER --- */
        .timer-unit { 
            background: rgba(40, 40, 45, 0.6); padding: 15px; border-radius: 8px; 
            margin-bottom: 12px; text-align: center; border: 1px solid rgba(255,255,255,0.1); 
            position: relative; overflow: hidden;
        }
        .actief .timer-unit { background: rgba(0, 255, 102, 0.15); border-color: var(--cyber-groen); }
        .actief .timer-unit::before {
            content: ""; position: absolute; top: -100%; left: 0; width: 100%; height: 100%;
            background: linear-gradient(to bottom, transparent, rgba(0, 255, 102, 0.2), transparent);
            animation: holo-scan 2s infinite linear; pointer-events: none;
        }
        .timer-display { font-size: 2.2rem; color: #666; }
        .actief .timer-display { color: var(--cyber-groen); text-shadow: 0 0 10px var(--cyber-groen); }

        .btn-cyber { padding: 12px 20px; border: 1px solid var(--cyber-blauw); cursor: pointer; font-weight: 700; border-radius: 6px; text-transform: uppercase; background: transparent; color: var(--cyber-blauw); transition: 0.3s; width: 100%; display: flex; align-items: center; justify-content: center; }
        .btn-start { border-color: var(--cyber-groen); color: var(--cyber-groen); }
        .btn-stop { border-color: #555; color: #888; }
        .actief .btn-stop { border-color: var(--cyber-rood); color: var(--cyber-rood); }

        .vervoer-box { display: flex; grid-column: 1/-1; background: #000; border: 1px solid rgba(0, 240, 255, 0.3); border-radius: 6px; overflow: hidden; padding: 2px; }
        .vervoer-box input { display: none; }
        .vervoer-box label { flex: 1; text-align: center; padding: 12px; cursor: pointer; opacity: 0.4; font-weight: bold; border-radius: 4px; transition: 0.3s; }
        .vervoer-box input:checked + label { opacity: 1; color: var(--cyber-blauw); border: 1px solid var(--cyber-blauw); }

        .container { max-width: 800px; margin: 20px auto; padding: 0 15px; }
        footer { position: fixed; bottom: 0; left: 0; right: 0; background: rgba(10, 12, 18, 0.95); backdrop-filter: blur(15px); border-top: 1px solid var(--cyber-blauw); padding: 15px 25px; display: flex; justify-content: space-between; align-items: center; z-index: 1500; }

        @keyframes holo-scan { 0% { top: -100%; } 100% { top: 100%; } }
        @keyframes holo-deploy { 0% { opacity: 0; transform: translateY(20px); } 100% { opacity: 1; transform: translateY(0); } }
        @keyframes holo-remove { 0% { opacity: 1; transform: translateX(0); } 100% { opacity: 0; transform: translateX(50px); filter: blur(10px); } }

        #print-area { display: none; }
        @media print {
            body > *:not(#print-area) { display: none !important; }
            #print-area { display: block !important; color: #000; background: #fff; padding: 20px; font-family: sans-serif; }
            table { width: 100%; border-collapse: collapse; margin-top: 20px; }
            th, td { border: 1px solid #000; padding: 8px; text-align: left; font-size: 12px; }
            th { background: #eee; }
        }
    </style>
</head>
<body>

<div id="print-area">
    <h1>Productieverslag</h1>
    <p id="p-meta"></p>
    <table id="p-tabel"></table>
</div>

<header>
    <div class="header-grid">
        <h2 style="color: var(--cyber-blauw); font-size: 0.9rem;">CORE_V35</h2>
        <div style="text-align: right; color: #fff; font-family: 'Orbitron';"><span id="u-top">0.00</span>U</div>
        <input type="text" id="op" placeholder="Naam Medewerker" oninput="save()">
        <input type="date" id="dag" onchange="load()">
        <div class="vervoer-box">
            <input type="radio" name="tr" id="f" value="Fiets" checked onchange="save()">
            <label for="f">ðŸš² FIETS</label>
            <input type="radio" name="tr" id="a" value="Wagen" onchange="save()">
            <label for="a">ðŸš— WAGEN</label>
        </div>
        <div class="search-wrap">
            <input type="text" id="q" placeholder="ZOEK KLANT OF DOSSIER..." oninput="search()">
            <div id="archiefLijst"></div>
        </div>
    </div>
</header>

<div class="container">
    <div id="lijst"></div>
    <button class="btn-cyber" style="background: var(--cyber-paars); color: #fff; border:none; margin-top:10px;" onclick="addKlant(null, true)">+ KLANT TOEVOEGEN</button>
</div>

<footer>
    <div style="font-family: 'Orbitron';">TOTAAL: <span id="u-bot" style="color: var(--cyber-blauw); font-size: 1.6rem;">0.00</span>U</div>
    <button class="btn-cyber" style="background: #fff; color: #000; border: none; width: auto;" onclick="printMe()">AFDRUKKEN</button>
</footer>

<script>
    const TYPES = ["Raam kader", "Raam vleugel", "Deur kader", "Deur vleugel", "Schuifraam kader", "Schuifraam vleugel", "T-profiel", "Glaslatten", "Beslag", "Opkuisen", "Montage", "Andere"];
    let timers = {}; 

    function getBelgianDate() { return new Date().toLocaleDateString('en-CA', { timeZone: 'Europe/Brussels' }); }

    function save() {
        const d = document.getElementById('dag').value;
        const data = {
            op: document.getElementById('op').value,
            tr: document.querySelector('input[name="tr"]:checked').value,
            klanten: [...document.querySelectorAll('.kaart:not(.removing)')].map(c => ({
                id: c.id, n: c.querySelector('.in-n').value, d: c.querySelector('.in-d').value,
                st: c.dataset.status || '', col: c.classList.contains('ingeklapt'),
                rijen: [...c.querySelectorAll('.r:not(.removing)')].map(r => ({
                    t: r.querySelector('.s-t').value, u: r.querySelector('.i-u').value,
                    o: r.querySelector('.i-o').value, s: parseInt(r.dataset.sec) || 0, id: r.id,
                    run: !!timers[r.id], st: r.dataset.start || ''
                }))
            }))
        };
        localStorage.setItem('urenV35_' + d, JSON.stringify(data));
        calc();
    }

    function load() {
        Object.values(timers).forEach(clearInterval);
        timers = {};
        document.getElementById('lijst').innerHTML = '';
        const raw = localStorage.getItem('urenV35_' + document.getElementById('dag').value);
        if (raw) {
            const data = JSON.parse(raw);
            document.getElementById('op').value = data.op || '';
            if(data.tr) document.getElementById(data.tr === 'Fiets' ? 'f' : 'a').checked = true;
            data.klanten.forEach(k => {
                addKlant(k);
                k.rijen.forEach(r => { if(r.run) timer(r.id, true, r.st); });
            });
        } else { addKlant(null, true); }
        calc();
    }

    function search() {
        const v = document.getElementById('q').value.toLowerCase();
        const r = document.getElementById('archiefLijst');
        if(v.length < 2) { r.classList.remove('open'); return; }
        let h = '';
        for(let i=0; i<localStorage.length; i++) {
            const k = localStorage.key(i);
            if(k.startsWith('urenV35_')) {
                const data = JSON.parse(localStorage.getItem(k));
                const datum = k.split('_')[1];
                data.klanten.forEach(kl => { 
                    if(kl.n.toLowerCase().includes(v) || kl.d.toLowerCase().includes(v)) {
                        h += `<div class="zoek-optie" onclick="jump('${datum}')">
                                <b>${kl.n}</b>
                                <span class="dos-label">DOSSIER: ${kl.d || 'GEEN'} | DATUM: ${datum}</span>
                              </div>`;
                    }
                });
            }
        }
        r.innerHTML = h || '<div class="zoek-optie">GEEN RESULTATEN</div>';
        r.classList.add('open');
    }

    function jump(d) { document.getElementById('dag').value = d; load(); document.getElementById('archiefLijst').classList.remove('open'); document.getElementById('q').value = ''; }

    function addKlant(data = null, isNew = false) {
        if (isNew) document.querySelectorAll('.kaart').forEach(k => k.classList.add('ingeklapt'));
        const id = data?.id || 'k' + Date.now();
        const html = `
            <div class="kaart status-${data?.st || ''} ${data?.col ? 'ingeklapt' : ''}" id="${id}" data-status="${data?.st || ''}">
                <div class="kaart-h" onclick="tgl('${id}')">
                    <div style="flex:1">
                        <h3><span class="n-txt">${data?.n || 'Nieuwe Klant'}</span> <small>[<span class="d-txt">${data?.d || '---'}</span>]</small></h3>
                    </div>
                    <div style="font-family:'Orbitron'; color:var(--cyber-blauw);"><span class="k-u">0.00</span>u</div>
                </div>
                <div class="kaart-anim-wrapper">
                    <div class="kaart-inner">
                        <div class="kaart-b">
                            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-bottom:15px">
                                <input type="text" class="in-n" value="${data?.n || ''}" placeholder="Naam" oninput="sync('${id}')">
                                <input type="text" class="in-d" value="${data?.d || ''}" placeholder="Dossier" oninput="sync('${id}')">
                            </div>
                            <div class="rijen"></div>
                            <button class="btn-cyber" style="border-style:dashed; margin-bottom:10px" onclick="addRij('${id}')">+ REGEL TOEVOEGEN</button>
                            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-bottom:10px">
                                <button class="btn-cyber" style="border-color:var(--cyber-groen); color:var(--cyber-groen)" onclick="setS('${id}','voltooid')">GEREED</button>
                                <button class="btn-cyber" style="border-color:var(--cyber-rood); color:var(--cyber-rood)" onclick="setS('${id}','fout')">FOUT</button>
                            </div>
                            <button class="btn-cyber" style="border-color:#444; color:#888; font-size:0.7rem;" onclick="wisKlant('${id}')">KLANT VERWIJDEREN</button>
                        </div>
                    </div>
                </div>
            </div>`;
        document.getElementById('lijst').insertAdjacentHTML('beforeend', html);
        if(data?.rijen) data.rijen.forEach(r => addRij(id, r)); else addRij(id);
        if(isNew) save();
    }

    function addRij(kid, r = null) {
        const rid = r?.id || 'r' + Math.random().toString(36).substr(2,5);
        const html = `
            <div class="r" id="${rid}" data-sec="${r?.s || 0}" data-start="${r?.st || ''}">
                <div class="timer-unit"><div class="timer-display">${fmt(r?.s || 0)}</div></div>
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-bottom:10px">
                    <button class="btn-cyber btn-start" onclick="timer('${rid}', true)">START</button>
                    <button class="btn-cyber btn-stop" onclick="timer('${rid}', false)">STOP</button>
                </div>
                <div style="display:grid; grid-template-columns: 1.5fr 1fr; gap:8px">
                    <select class="s-t" onchange="save()">${TYPES.map(t => `<option ${r?.t === t ? 'selected' : ''}>${t}</option>`).join('')}</select>
                    <input type="number" class="i-u" value="${r?.u || '0.00'}" step="0.25" oninput="save()">
                </div>
                <textarea class="i-o" placeholder="Opmerking..." oninput="save()" style="margin-top:8px; height:40px">${r?.o || ''}</textarea>
                <button class="btn-cyber" style="border:none; color:var(--cyber-rood); font-size:0.65rem; margin-top:5px" onclick="wisRij('${rid}')">VERWIJDER REGEL</button>
            </div>`;
        document.getElementById(kid).querySelector('.rijen').insertAdjacentHTML('beforeend', html);
    }

    function timer(rid, s, forceStart = null) {
        const el = document.getElementById(rid);
        if(!el) return;
        if(s) {
            if(timers[rid]) return;
            el.dataset.start = forceStart || Date.now();
            el.classList.add('actief');
            timers[rid] = setInterval(() => {
                const sec = (parseInt(el.dataset.sec) || 0) + Math.floor((Date.now() - parseInt(el.dataset.start)) / 1000);
                el.querySelector('.timer-display').innerText = fmt(sec);
            }, 1000);
        } else {
            if(timers[rid]) {
                clearInterval(timers[rid]);
                delete timers[rid];
                el.dataset.sec = (parseInt(el.dataset.sec) || 0) + Math.floor((Date.now() - parseInt(el.dataset.start)) / 1000);
                el.dataset.start = '';
                el.querySelector('.i-u').value = (Math.round((parseInt(el.dataset.sec)/3600)*4)/4).toFixed(2);
                el.classList.remove('actief');
            }
        }
        save();
    }

    function wisRij(rid) { if(timers[rid]) { clearInterval(timers[rid]); delete timers[rid]; } const el = document.getElementById(rid); el.classList.add('removing'); setTimeout(() => { el.remove(); save(); }, 400); }
    function wisKlant(kid) { if(confirm("Klant volledig verwijderen?")) { const el = document.getElementById(kid); el.querySelectorAll('.r').forEach(r => { if(timers[r.id]) { clearInterval(timers[r.id]); delete timers[r.id]; } }); el.classList.add('removing'); setTimeout(() => { el.remove(); save(); }, 400); } }
    function tgl(id) { if(!event.target.closest('input, button, select, textarea')) { document.getElementById(id).classList.toggle('ingeklapt'); save(); } }
    function sync(id) { const c = document.getElementById(id); c.querySelector('.n-txt').innerText = c.querySelector('.in-n').value || 'Klant'; c.querySelector('.d-txt').innerText = c.querySelector('.in-d').value || '---'; save(); }
    function setS(id, s) { const c = document.getElementById(id); c.dataset.status = s; c.className = `kaart status-${s} ingeklapt`; save(); }
    function fmt(s) { return `${Math.floor(s/3600).toString().padStart(2,'0')}:${Math.floor((s%3600)/60).toString().padStart(2,'0')}:${(s%60).toString().padStart(2,'0')}`; }
    function calc() { let dag = 0; document.querySelectorAll('.kaart:not(.removing)').forEach(c => { let k = 0; c.querySelectorAll('.i-u').forEach(i => k += parseFloat(i.value) || 0); c.querySelector('.k-u').innerText = k.toFixed(2); dag += k; }); document.getElementById('u-bot').innerText = dag.toFixed(2); document.getElementById('u-top').innerText = dag.toFixed(2); }

    function printMe() {
        const tr = document.querySelector('input[name="tr"]:checked').value;
        document.getElementById('p-meta').innerHTML = `<b>Medewerker:</b> ${document.getElementById('op').value} | <b>Datum:</b> ${document.getElementById('dag').value} | <b>Vervoer:</b> ${tr} | <b>Totaal:</b> ${document.getElementById('u-bot').innerText}u`;
        let h = '<tr><th>Klant</th><th>Dossier</th><th>Werkzaamheid</th><th>Uren</th><th>Opmerking</th></tr>';
        document.querySelectorAll('.kaart').forEach(k => {
            const kn = k.querySelector('.in-n').value; const kd = k.querySelector('.in-d').value;
            k.querySelectorAll('.r').forEach(r => { 
                h += `<tr><td>${kn}</td><td>${kd}</td><td>${r.querySelector('.s-t').value}</td><td>${r.querySelector('.i-u').value}u</td><td>${r.querySelector('.i-o').value}</td></tr>`; 
            });
        });
        document.getElementById('p-tabel').innerHTML = h;
        window.print();
    }

    window.onload = () => { if(!document.getElementById('dag').value) document.getElementById('dag').value = getBelgianDate(); load(); };
</script>
</body>
</html>
