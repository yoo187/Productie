<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Productie Registratie Professioneel</title>

<style>
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:Arial,sans-serif;background:#f2f4f7}
.app{padding:12px}

h1{text-align:center;font-size:1.6rem;margin:12px 0 20px}
h2{font-size:1.3rem;margin-bottom:12px}
h3{font-size:1.1rem;margin:10px 0}

.day-title{font-weight:bold;margin:12px 0}

.card{
  background:#fff;
  border-radius:14px;
  padding:14px;
  margin-bottom:14px;
  box-shadow:0 3px 8px rgba(0,0,0,.08);
}

.card.readonly{opacity:.95}

.grid{display:flex;flex-direction:column;gap:10px;margin-bottom:10px}

label{font-weight:bold;font-size:.9rem;margin-bottom:3px;display:block}

input,select,textarea{
  width:100%;
  padding:12px;
  font-size:1rem;
  border-radius:10px;
  border:1px solid #ccc;
}

textarea{resize:vertical}

button{
  padding:10px;
  font-size:.95rem;
  border-radius:8px;
  border:none;
  cursor:pointer
}

.add{background:#2ecc71;color:#fff}
.remove{background:#e74c3c;color:#fff}
.done{background:#27ae60;color:#fff}
.notdone{background:#c0392b;color:#fff}
.delete-klant{background:#555;color:#fff;margin-top:8px}

.productie-row{
  display:flex;
  flex-direction:column;
  gap:8px;
  padding:10px;
  border-radius:10px;
  border:2px solid #ddd;
  margin-bottom:10px;
}

/* Status */
.in-progress{border-color:#f39c12;background:#fff3e0}
.done-row{border-color:#27ae60;background:#eafaf1}
.notdone-row{border-color:#c0392b;background:#fde6e0}

.actions{display:flex;gap:6px;flex-wrap:wrap}

.search-block{
  background:#eef1f5;
  border-radius:14px;
  padding:14px;
  margin-bottom:18px
}

@media(min-width:768px){
  .grid{flex-direction:row}
  .productie-row{flex-direction:row;flex-wrap:wrap}
  .productie-row>div{flex:1;min-width:120px}
}

/* PRINT */
@media print{
  body{background:#fff}
  button,.search-block{display:none!important}
  .app{padding:0}

  .card{
    box-shadow:none;
    border-radius:0;
    padding:6px;
    margin-bottom:6px;
    break-inside:avoid;
  }

  .productie-row{
    border:none;
    padding:4px;
    margin-bottom:4px;
  }

  input,textarea,select{
    border:none;
    padding:0;
    font-size:.9rem;
    background:transparent;
  }

  label{font-size:.75rem}
  h1{font-size:1.2rem;margin-bottom:8px}
  h2{font-size:1rem}
  h3{font-size:.9rem}
}
</style>
</head>

<body>
<div class="app">

<h1>Productie Registratie</h1>

<div class="card">
<h2>Algemene gegevens</h2>
<div class="grid">
  <div><label>Naam</label><input value="Denislav Dimitrov" readonly></div>
  <div><label>Datum</label><input type="date" id="datum"></div>
  <div>
    <label>Vervoer</label>
    <select id="vervoer">
      <option>Fiets</option>
      <option>Wagen</option>
    </select>
  </div>
</div>
</div>

<div class="search-block">
<label>Zoeken op dossier</label>
<input placeholder="Dossier nummer..." oninput="zoekAlleDagen(this.value)">
<div id="zoekResultaten"></div>
</div>

<div id="productieCards"></div>

<button class="add" onclick="nieuweKlant()">Nieuwe klant / dossier</button>
<h3>Dag totaal: <span id="dagTotaal">0.00</span> uur</h3>
<button onclick="window.print()">Afdrukken / Opslaan PDF</button>

</div>

<script>
const types=[
"Raam kader","Raam vleugel","Deur kader","Deur vleugel",
"Schuifraam kader","Schuifraam vleugel","T-profiel",
"Glaslatten","Beslag","Opkuisen","Montage"
];

const datum=document.getElementById("datum");
datum.valueAsDate=new Date();
const key=()=>`productie-${datum.value}`;

function format(d){
 const x=new Date(d);
 return `${String(x.getDate()).padStart(2,'0')}-${String(x.getMonth()+1).padStart(2,'0')}-${x.getFullYear()}`;
}

function nieuweKlant(data={}){
 const c=document.createElement("div");
 c.className="card";
 c.innerHTML=`
 <div class="grid">
  <div><label>Klant</label><input value="${data.klant||""}"></div>
  <div><label>Dossier</label><input value="${data.dossier||""}"></div>
 </div>
 ${(data.rijen||[{}]).map(r=>rijHTML(r)).join("")}
 <button class="add" onclick="addRij(this)">Rij toevoegen</button>
 <strong>Totaal klant: <span class="klantTotaal">0.00</span></strong>
 <button class="delete-klant" onclick="this.parentElement.remove();opslaan()">Klant verwijderen</button>
 `;
 document.getElementById("productieCards").appendChild(c);
 bereken(); opslaan();
}

function rijHTML(r={}){
 return `
 <div class="productie-row ${r.status||"in-progress"}">
  <div><label>Type</label><input value="${r.type||""}"></div>
  <div><label>Aantal</label><input value="${r.aantal||0}"></div>
  <div><label>Uren</label><input class="uren" value="${r.uren||0}" oninput="opslaan()"></div>
  <div><label>Opmerking</label><textarea>${r.opmerking||""}</textarea></div>
 </div>`;
}

function bereken(){
 let dag=0;
 document.querySelectorAll(".card").forEach(c=>{
  let k=0;
  c.querySelectorAll(".uren").forEach(u=>k+=Number(u.value||0));
  c.querySelector(".klantTotaal")?.textContent=k.toFixed(2);
  dag+=k;
 });
 document.getElementById("dagTotaal").textContent=dag.toFixed(2);
}

function opslaan(){
 bereken();
 const data=[...document.querySelectorAll("#productieCards .card")].map(c=>({
  klant:c.querySelectorAll("input")[0].value,
  dossier:c.querySelectorAll("input")[1].value,
  rijen:[...c.querySelectorAll(".productie-row")].map(r=>({
   type:r.querySelector("input").value,
   aantal:r.querySelectorAll("input")[1].value,
   uren:r.querySelectorAll("input")[2].value,
   opmerking:r.querySelector("textarea").value,
   status:r.classList.contains("done-row")?"done-row":
          r.classList.contains("notdone-row")?"notdone-row":"in-progress"
  }))
 }));
 localStorage
