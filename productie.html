<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Productie Registratie</title>
<style>
/* === ORIGINELE CSS – ONGEWIJZIGD === */
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:Arial,sans-serif;background:#f2f4f7}
.app{padding:12px}
h1{text-align:center;font-size:1.6rem;margin:12px 0 20px}
input, select, textarea{
  padding:12px;font-size:1rem;border-radius:10px;border:1px solid #ccc;
  margin-bottom:12px;display:block;width:100%;font-family: Arial, sans-serif;
  transition: all 0.3s ease;
}
input:focus, select:focus, textarea:focus{
  border-color:#3498db;box-shadow:0 0 8px rgba(52,152,219,.2);outline:none;
}
textarea{resize: vertical;box-shadow: inset 0 2px 4px rgba(0,0,0,0.05);}
.controls{display:flex;gap:10px;margin-bottom:16px;justify-content:center;flex-wrap:wrap}
button{padding:12px;border-radius:10px;border:none;cursor:pointer;font-size:1rem;
  transition:all .3s ease;box-shadow:0 2px 6px rgba(0,0,0,.1);}
button:hover{transform:translateY(-2px);box-shadow:0 4px 12px rgba(0,0,0,.15);}
button:active{transform:translateY(0) scale(0.97);}
.add{background:#2ecc71;color:#fff}.remove{background:#e74c3c;color:#fff}
.done{background:#27ae60;color:#fff}.notdone{background:#c0392b;color:#fff}
.delete-klant{background:#555;color:#fff}
.timer-start{background:#3498db;color:#fff}
.timer-stop{background:#7f8c8d;color:#fff}

.card{background:#fff;border-radius:16px;padding:14px;margin-bottom:16px;box-shadow:0 4px 10px rgba(0,0,0,.08);overflow:hidden;border-left:8px solid #ccc;transition:all .35s ease}

.timer-display{
  font-weight:bold;
  text-align:center;
  padding:4px;
  background:#eef3f7;
  border-radius:6px;
}

@media print{
  .timer-display,.timer-start,.timer-stop{display:none!important}
}
</style>
</head>

<body>
<div class="app">
<h1>Productie Registratie</h1>

<input type="date" id="datum">
<div id="productieCards"></div>
<button class="add" onclick="nieuweKlant()">Nieuwe klant</button>
<h3>Dag totaal: <span id="dagTotaal">0.00</span></h3>
</div>

<script>
/* === ORIGINELE JS – ONGEWIJZIGD TOT AAN TOEVOEGINGEN === */

const types=["Raam kader","Raam vleugel","Deur kader","Deur vleugel","Andere"];
const productieCards=document.getElementById("productieCards");
const dagTotaal=document.getElementById("dagTotaal");
const datum=document.getElementById("datum");

function key(){ return "productie-"+datum.value; }

/* =======================
   TIMER TOEVOEGING START
======================= */
function formatTimer(sec){
  const h=String(Math.floor(sec/3600)).padStart(2,'0');
  const m=String(Math.floor((sec%3600)/60)).padStart(2,'0');
  const s=String(Math.floor(sec%60)).padStart(2,'0');
  return `${h}:${m}:${s}`;
}

function rond15min(sec){
  const min=Math.round((sec/60)/15)*15;
  return (min/60).toFixed(2);
}
/* =======================
   TIMER TOEVOEGING EINDE
======================= */

function editRijHTML(r={}){
  const sec=r.seconden||0;
  return `
<div class="productie-row" data-seconden="${sec}" data-running="false">
<div><label>Type</label><select>${types.map(t=>`<option ${r.type===t?"selected":""}>${t}</option>`).join("")}</select></div>

<!-- TIMER TOEVOEGING -->
<div>
  <label>Timer</label>
  <div class="timer-display">${formatTimer(sec)}</div>
</div>

<div><label>Uren</label><input type="number" step="0.01" class="uren-input" value="${r.uren||0}"></div>
<div class="actions">
<button class="timer-start">Start</button>
<button class="timer-stop">Stop</button>
<button class="remove">X</button>
</div></div>`;
}

function nieuweKlant(data=null){
  const card=document.createElement("div");
  card.className="card";
  card.innerHTML=`
    <input placeholder="Klant" value="${data?.klant||""}">
    <input placeholder="Dossier" value="${data?.dossier||""}">
    ${(data?.rijen||[{}]).map(editRijHTML).join("")}
    <button class="add">Rij toevoegen</button>
  `;
  productieCards.appendChild(card);
  bind(card);
  bereken();
}

function bind(card){
  card.querySelectorAll(".timer-start").forEach(b=>{
    b.onclick=()=>startTimer(b.closest(".productie-row"));
  });
  card.querySelectorAll(".timer-stop").forEach(b=>{
    b.onclick=()=>stopTimer(b.closest(".productie-row"));
  });
  card.querySelectorAll(".remove").forEach(b=>{
    b.onclick=()=>{b.closest(".productie-row").remove();opslaan();}
  });
  card.querySelector(".add").onclick=()=>{
    card.querySelector(".add").insertAdjacentHTML("beforebegin",editRijHTML());
    bind(card);
  };
}

function startTimer(row){
  if(row.dataset.running==="true") return;
  row.dataset.running="true";
  row.dataset.start=Date.now();
  row.interval=setInterval(()=>{
    const sec=Number(row.dataset.seconden)+(Date.now()-row.dataset.start)/1000;
    row.querySelector(".timer-display").textContent=formatTimer(sec);
  },1000);
}

function stopTimer(row){
  if(row.dataset.running!=="true") return;
  clearInterval(row.interval);
  const sec=Number(row.dataset.seconden)+(Date.now()-row.dataset.start)/1000;
  row.dataset.seconden=sec;
  row.dataset.running="false";
  row.querySelector(".uren-input").value=rond15min(sec);
  row.querySelector(".timer-display").textContent=formatTimer(sec);
  opslaan();
}

function bereken(){
  let totaal=0;
  document.querySelectorAll(".uren-input").forEach(i=>totaal+=+i.value||0);
  dagTotaal.textContent=totaal.toFixed(2);
}

function opslaan(){
  bereken();
  const data=[...document.querySelectorAll(".card")].map(c=>({
    klant:c.querySelectorAll("input")[0].value,
    dossier:c.querySelectorAll("input")[1].value,
    rijen:[...c.querySelectorAll(".productie-row")].map(r=>({
      type:r.querySelector("select").value,
      uren:r.querySelector(".uren-input").value,
      seconden:r.dataset.seconden
    }))
  }));
  localStorage.setItem(key(),JSON.stringify(data));
}

function laadDag(){
  productieCards.innerHTML="";
  const data=JSON.parse(localStorage.getItem(key())||"null");
  if(!data){nieuweKlant();return;}
  data.forEach(nieuweKlant);
  bereken();
}

datum.value=new Date().toISOString().split("T")[0];
datum.onchange=laadDag;
laadDag();
</script>
</body>
</html>
